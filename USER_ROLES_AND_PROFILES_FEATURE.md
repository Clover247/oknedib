### **Технічне Завдання: Система Ролей, Профілі та Доступи (v1)**

**1. Мета та Загальний Опис**

Реалізувати комплексну систему управління користувачами, доступом та налаштуваннями профілю. Мета — створити чітку ієрархію ролей, як у Jira, де кожен користувач має строго визначені повноваження, а також надати користувачам можливість керувати власними даними.

**2. Ієрархія Ролей та Рівні Доступу (RBAC - Role-Based Access Control)**

Система повинна підтримувати три основні ролі з наступними правами:

*   **`ADMIN` (Адміністратор):**
    *   **Повноваження:** Повний доступ до всієї системи ("Super User").
    *   **Користувачі:** Може створювати, редагувати (включаючи зміну ролі) та видаляти будь-яких користувачів.
    *   **Проекти:** Може створювати, переглядати, редагувати та видаляти **всі** проекти в системі.
    *   **Доступи:** Може призначати та видаляти Менеджерів та Спеціалістів на будь-який проект.

*   **`MANAGER` (Менеджер):**
    *   **Повноваження:** Керує довіреними йому проектами та командами.
    *   **Проекти:** Бачить у списку та має повний доступ **тільки до тих проектів, на які його призначив Адміністратор**.
    *   **Команда проекту:** В межах своїх проектів може додавати та видаляти Спеціалістів. Не може керувати іншими Менеджерами.
    *   **Задачі:** В межах своїх проектів може створювати задачі та призначати їх на будь-якого Спеціаліста з команди проекту.

*   **`SPECIALIST` (Спеціаліст):**
    *   **Повноваження:** Виконавець задач ("Головний терпілич").
    *   **Проекти:** Бачить у списку та має доступ **тільки до тих проектів, на які його призначив Менеджер або Адміністратор**.
    *   **Задачі:** В межах своїх проектів може:
        *   Переглядати всі задачі.
        *   Призначати **на себе** вільні задачі.
        *   Змінювати статус, опис та додавати коментарі до задач, які призначені на нього.
    *   **Обмеження:** Не може створювати нові проекти, керувати користувачами або бюджетом.

**3. Функціонал Профілю Користувача**

1.  **Сторінка Профілю (`/profile`):**
    *   Створити нову сторінку, доступну всім авторизованим користувачам.
    *   На сторінці відображається форма для редагування особистих даних: `firstName`, `lastName`.
    *   Можливість змінити пароль (поточний пароль, новий пароль, підтвердження нового).

2.  **Аватар Користувача:**
    *   На сторінці профілю реалізувати функціонал завантаження, оновлення та видалення аватара.
    *   Аватар повинен відображатися в `Header` та біля імені користувача в коментарях, задачах і т.д.

3.  **Кнопка "Вийти" (Logout):**
    *   Додати кнопку "Вийти" у `Sidebar` або `Header`.
    *   При натисканні сесія користувача (токен) видаляється, і його перенаправляє на сторінку логіну.

**4. План Реалізації**

**Backend:**

1.  **Оновити `User` Entity:** Додати поле `avatarUrl: string | null`.
2.  **Створити `RolesGuard`:** Реалізувати кастомний Guard, який буде перевіряти роль користувача з JWT-токену та порівнювати її з ролями, дозволеними для конкретного ендпоінту.
3.  **Захистити Ендпоінти:** Застосувати `RolesGuard` до всіх існуючих та нових контролерів, щоб реалізувати логіку доступу (наприклад, `@Roles('ADMIN')` для видалення користувача).
4.  **Оновити Сервіси:** Модифікувати логіку в сервісах (`ProjectsService`, `TasksService`), щоб вони повертали дані відповідно до ролі користувача (наприклад, `getProjects` для Менеджера повинен повертати тільки його проекти).
5.  **API для Управління Користувачами:** Створити ендпоінти для Адміністратора (`GET /users`, `PATCH /users/:id`) та Менеджера (`POST /projects/:id/specialists`, `DELETE /projects/:id/specialists/:userId`).
6.  **API для Профілю:** Створити ендпоінти `PATCH /profile/details` та `POST /profile/avatar` (з використанням `FileInterceptor` та `CloudinaryService`).

**Frontend:**

1.  **Створити Сторінку Профілю:** Реалізувати сторінку `/profile` з формою для редагування даних та компонентом для завантаження аватара.
2.  **Реалізувати RBAC в UI:** Створити кастомний хук `useAuth()`, який повертає роль поточного користувача. Використовувати цей хук для умовного рендерингу кнопок та елементів інтерфейсу (наприклад, показувати кнопку "Видалити проект" тільки для Адміністратора).
3.  **Реалізувати Logout:** Додати кнопку "Вийти", яка очищує Redux state та перенаправляє на сторінку логіну.
4.  **Оновити API Slices:** Додати нові `mutations` та `queries` для роботи з профілем та управлінням користувачами.
